<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Lighting.Slider.Test</title>
    <link rel="stylesheet" href="http://apps.bdimg.com/libs/jqueryui/1.10.4/css/jquery-ui.min.css">
    <script src="http://apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>

    <link rel="stylesheet" href="http://jqueryui.com/resources/demos/style.css">

    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <!-- 引处MQTT.MINI.JS库文件 -->
    <style>
        #sliderlight {
            width: 480px;
            margin: 15px;
        }
        
        #sliderlight .ui-slider-range {
            background: #729fcf;
        }
        
        #sliderlight .ui-slider-handle {
            border-color: #729fcf;
        }
    </style>


</head>


<body>
    <center>
        <h2>灯具亮度远程控制</h2>

        <div id="sliderlight"></div><br>

        <p><label for="amount">灯具亮度级别：</label>
            <input type="text" id="amount" style="border:0; color:#f6931f; font-weight:bold;">
        </p>
    </center>


</body>



<script>
    // Create a client instance
    var options = {
            clean: true,
            connectTimeout: 4000,
            //mqtt客户端的id，这里面应该还可以加上其他参数，具体看官方文档
            clientId: "james-4-id",
            username: 'james-con-test',
            password: 'james'

        }
        //console.log(options.clientId);

    //浏览器采用websocket协议，host主机地址为192.168.0.200，端口为9001，路径为/mqtt
    var client = mqtt.connect("ws://broker.hivemq.com:8000/mqtt", options) // you add a ws:// url here

    //建立连接
    client.on('connect', function() {
        console.log("connect success!")
            //订阅主题 presence
            /* client.subscribe('presence', function(err) {
                 if (!err) {
                     console.log("subscribe success!")

                 } else {
                     //打印错误
                     console.log(err)
                 }
             }) */
    })

    //如果连接错误，打印错误
    client.on('error', function(err) {
        console.log(err)
        client.end()
    })

    //如果client订阅主题成功，那么这里就是当接收到自己订阅主题的处理逻辑
    client.on('message', function(topic, message) {
        // message is Buffer,此处就是打印消息的具体内容
        console.log('-> ' + message.toString())
        $(function() {
            $("#LState").html(message.toString());
        });

    });






    // 用户程序点击事件
    /* function Onmqtttest() {
         message = "message from browser with websocket"; // 消息内容
         //发布主题presence,消息内容为Hello mqtt,订阅与推送一样自发自收
         client.publish('presence', 'Hello mqtt ' + message)
     } */
</script>
<script>
    $(function() {
        $("#sliderlight").slider({
            orientation: "horizontal",
            range: "min",
            max: 100,
            value: 0,
            change: upload

        });

    });

    function upload() {
        var light = $("#sliderlight").slider("value");
        message = light.toString();
        $("#amount").val(light);
        client.publish('jamesxie/ledSlider', message);
    }
</script>

<script type="text/javascript">
    window.onload = function() {
        //屏蔽键盘事件
        document.onkeydown = function() {
            var e = window.event || arguments[0];
            //F12
            if (e.keyCode == 123) {
                return false;
                //Ctrl+Shift+I
            } else if ((e.ctrlKey) && (e.shiftKey) && (e.keyCode == 73)) {
                return false;
                //Shift+F10
            } else if ((e.shiftKey) && (e.keyCode == 121)) {
                return false;
                //Ctrl+U
            } else if ((e.ctrlKey) && (e.keyCode == 85)) {
                return false;
            }
        };
        //屏蔽鼠标右键
        document.oncontextmenu = function() {
            return false;
        }
    }
</script>

</html>